{% extends "base.html" %}
{% block content %}
<h3 class="text-black mb-3">My Appointments</h3>

<div class="mb-2 text-muted small">
  Logged in as: {{ request.user.email }} (id {{ request.user.id }})
</div>

<ul class="nav nav-tabs mb-3">
  <li class="nav-item">
    <button class="nav-link active" id="tab-upcoming" data-bs-toggle="tab" data-bs-target="#upcoming-pane" type="button">
      Upcoming
    </button>
  </li>
  <li class="nav-item">
    <button class="nav-link" id="tab-past" data-bs-toggle="tab" data-bs-target="#past-pane" type="button">
      Past
    </button>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane fade show active" id="upcoming-pane">
    {% if upcoming_appointments %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Date</th>
              <th>Patient</th>
              <th>Reason</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            {% for a in upcoming_appointments %}
            <tr>
              <td>{{ a.date }}</td>
              <td>{{ a.patient.get_full_name|default:a.patient.username }}</td>
              <td>{{ a.reason }}</td>
              <td>
                <a href="{% url 'appointments:doctor_notes' a.id %}" class="btn btn-primary btn-sm text-white">
                  Notes
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted mb-0">You have no upcoming confirmed appointments.</p>
    {% endif %}
  </div>

  <div class="tab-pane fade" id="past-pane">
    {% if past_appointments %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Date</th>
              <th>Patient</th>
              <th>Reason</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            {% for a in past_appointments %}
            <tr>
              <td>{{ a.date }}</td>
              <td>{{ a.patient.get_full_name|default:a.patient.username }}</td>
              <td>{{ a.reason }}</td>
              <td>
                <a href="{% url 'appointments:doctor_notes' a.pk %}" class="btn btn-sm btn-outline-primary">
                  Notes
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted mb-0">You have no past confirmed appointments.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
